angular.module("myApp",[]).factory("gameLogic",function(){"use strict";function a(){return[["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""]]}function b(){return{totalMove:0,winner:"",moveIndex:1}}function c(a){return a.totalMove>=361}function d(a,b,c){var d,e,f=a[b][c];for(d=b-1,e=b+1;d>=0&&a[d][c]===f;)d--;for(;e<a.length&&a[e][c]===f;)e++;if(e-d-1>=6)return!0;for(d=c-1,e=c+1;d>=0&&a[b][d]===f;)d--;for(;e<a.length&&a[b][e]===f;)e++;if(e-d-1>=6)return!0;for(d=-1,e=1;b+d>=0&&c+d>=0&&a[b+d][c+d]===f;)d--;for(;b+e<a.length&&c+e<a.length&&a[b+e][c+e]===f;)e++;if(e-d-1>=6)return!0;for(d=-1,e=1;b+d>=0&&c-d<a.length&&a[b+d][c-d]===f;)d--;for(;b+e<a.length&&c-e>=0&&a[b+e][c-e]===f;)e++;return e-d-1>=6?!0:!1}function e(e,f,g,h,i){if(void 0===e&&(e=a()),void 0===i&&(i=b()),""!==e[f][g])throw new Error("One can only make a move in an empty position!");if(""!==i.winner)throw new Error("Can only make a move if the game is not over!");var j,k,l=angular.copy(e),m=angular.copy(i);return m.moveIndex=(m.moveIndex+1)%4,m.totalMove++,l[f][g]=0===h?"X":"O",k=d(l,f,g)?l[f][g]:"",j=""!==k||c(m)?{endMatch:{endMatchScores:"X"===k?[1,0]:"O"===k?[0,1]:[0,0]}}:{setTurn:{turnIndex:0===m.moveIndex||1===m.moveIndex?0:1}},m.winner=k,[j,{set:{key:"board",value:l}},{set:{key:"delta",value:{row:f,col:g}}},{set:{key:"gameData",value:m}}]}function f(a,b,c){var d,f,g=[];for(d=0;19>d;d++)for(f=0;19>f;f++)try{g.push(e(a,d,f,b,c))}catch(h){}return g}function g(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var f=b[2].set.value,g=f.row,h=f.col,i=d.board,j=d.gameData,k=e(i,g,h,c,j);if(!angular.equals(b,k))return!1}catch(l){return!1}return!0}return{getInitialBoard:a,getInitialGameData:b,getPossibleMoves:f,createMove:e,isMoveOk:g}}),angular.module("myApp").controller("Ctrl",["$rootScope","$scope","$log","$timeout","gameService","stateService","gameLogic","aiService","resizeGameAreaService",function(a,b,c,d,e,f,g,h,i){"use strict";function j(){a.$apply(function(){c.info("Animation ended"),u=!0,w&&k()})}function k(){var a=g.getPossibleMoves(x.board,y,x.gameData),b=Math.floor(Math.random()*a.length);e.makeMove(a[b])}function l(a){u=!1,x=a.stateAfterMove,A=a.playMode,z=a.turnIndexBeforeMove,void 0===x.board&&(x.board=g.getInitialBoard()),void 0===x.gameData&&(x.gameData=g.getInitialGameData()),v=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,y=a.turnIndexAfterMove,w=v&&""===a.playersInfo[a.yourPlayerIndex].playerId,w&&(v=!1)}function m(a,b){var c=void 0!==x.delta&&x.delta.row===a&&x.delta.col===b;return!u&&c&&("playAgainstTheComputer"===A&&0===z||"passAndPlay"===A||"playBlack"===A&&1===z||"playWhite"===A&&0===z)}function n(a,b){var c=void 0!==x.delta&&x.delta.row===a&&x.delta.col===b;return!u&&c&&!m(a,b)}function o(a){for(var b=[],c=0;a>c;c++)b.push(c);return b}function p(a,b,c){if(v){var d=b-F.offsetLeft,e=c-F.offsetTop;if(0>d||0>e||d>=F.clientWidth||e>=F.clientHeight)return E.style.display="none",void(B.style.display="none");E.style.display="inline",B.style.display="inline";var f=Math.floor(H*d/F.clientWidth),g=Math.floor(G*e/F.clientHeight),h=s(g,f);D.setAttribute("x1",h.x),D.setAttribute("x2",h.x),C.setAttribute("y1",h.y),C.setAttribute("y2",h.y);var i=r(g,f);E.style.left=i.left+"px",E.style.top=i.top+"px",("touchend"===a||"touchcancel"===a||"touchleave"===a||"mouseup"===a)&&(E.style.display="none",B.style.display="none",t(g,f))}}function q(){return{width:F.clientWidth/H,height:F.clientHeight/G}}function r(a,b){var c=q();return{top:a*c.height,left:b*c.width}}function s(a,b){var c=q();return{x:b*c.width+c.width/2,y:a*c.height+c.height/2}}function t(d,e){b.cellClicked(d,e),a.$apply(function(){c.info("Dragged to "+d+"x"+e)})}i.setWidthToHeight(1);var u=!1,v=!1,w=!1,x=null,y=null,z=null,A=null;document.addEventListener("animationend",j,!1),document.addEventListener("webkitAnimationEnd",j,!1),document.addEventListener("oanimationend",j,!1),window.e2e_test_stateService=f,b.cellClicked=function(a,b){if(c.info(["Clicked on cell:",a,b]),v)try{var d=g.createMove(x.board,a,b,y,x.gameData);v=!1,e.makeMove(d)}catch(f){return void c.info(["Cell is already full in position:",a,b])}},b.shouldShowImage=function(a,b){var c=x.board[a][b];return""!==c},b.getImageSrc=function(a,b){var c=x.board[a][b];return"X"===c?"imgsrc/black.png":"O"===c?"imgsrc/white.png":""},b.getClass=function(a,b){return{piece:!0,animation:n(a,b),slowlyAppear:m(a,b)}};var B=document.getElementById("draggingLines"),C=document.getElementById("horizontalDraggingLine"),D=document.getElementById("verticalDraggingLine"),E=document.getElementById("clickToDragPiece"),F=document.getElementById("gameArea"),G=19,H=19;b.getPreviewSrc=function(){return 1===y?"imgsrc/white.png":"imgsrc/black.png"},window.handleDragEvent=p,b.rows=o(G),b.cols=o(H),b.rowsNum=G,b.colsNum=H,e.setGame({gameDeveloperEmail:"wuping.lei@nyu.edu",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:g.isMoveOk,updateUI:l})}]),angular.module("myApp").factory("aiService",["alphaBetaService","gameLogic",function(a,b){"use strict";function c(a){if(a[0].endMatch){var b=a[0].endMatch.endMatchScores;return b[0]>b[1]?Number.POSITIVE_INFINITY:b[0]<b[1]?Number.NEGATIVE_INFINITY:0}return 0}function d(a,c){return b.getPossibleMoves(a[1].set.value,c,a[3].set.value)}function e(a){return"\n"+a[1].set.value.join("\n")+"\n"}function f(b,f,g,h){return a.alphaBetaDecision([null,{set:{key:"board",value:b}},null,{set:{key:"gameData",value:g}}],f,d,c,"?debug"===window.location.search?e:null,h)}return{createComputerMove:f}}]);
//# sourceMappingURL=everything.min.js.map