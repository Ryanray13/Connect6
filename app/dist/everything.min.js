angular.module("myApp",[]).factory("gameLogic",function(){"use strict";function a(){return[["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""]]}function b(){return{totalMove:0,winner:"",moveIndex:1}}function c(a){return a.totalMove>=361}function d(a,b,c,d){var e,f;for(e=b-1,f=b+1;e>=0&&a[e][c]===d;)e--;for(;f<a.length&&a[f][c]===d;)f++;if(f-e-1>=6)return!0;for(e=c-1,f=c+1;e>=0&&a[b][e]===d;)e--;for(;f<a.length&&a[b][f]===d;)f++;if(f-e-1>=6)return!0;for(e=-1,f=1;b+e>=0&&c+e>=0&&a[b+e][c+e]===d;)e--;for(;b+f<a.length&&c+f<a.length&&a[b+f][c+f]===d;)f++;if(f-e-1>=6)return!0;for(e=-1,f=1;b+e>=0&&c-e<a.length&&a[b+e][c-e]===d;)e--;for(;b+f<a.length&&c-f>=0&&a[b+f][c-f]===d;)f++;return f-e-1>=6?!0:!1}function e(a,b,c,d){var e,f,g,h=0;for(e=b-1,f=b+1;e>=0&&a[e][c]===d;)e--;for(;f<a.length&&a[f][c]===d;)f++;if(g=f-e-1,5===g&&(f<a.length&&""===a[f][c]||e>=0&&""===a[e][c])||6===g)return 1;for((3===g&&f<a.length&&""===a[f][c]&&e>=0&&""===a[e][c]||4===g)&&h++,e=c-1,f=c+1;e>=0&&a[b][e]===d;)e--;for(;f<a.length&&a[b][f]===d;)f++;if(g=f-e-1,5===g&&(f<a.length&&""===a[b][f]||e>=0&&""===a[b][e])||6===g)return 1;for((3===g&&f<a.length&&""===a[b][f]&&e>=0&&""===a[b][e]||4===g)&&h++,e=-1,f=1;b+e>=0&&c+e>=0&&a[b+e][c+e]===d;)e--;for(;b+f<a.length&&c+f<a.length&&a[b+f][c+f]===d;)f++;if(g=f-e-1,5===g&&(b+f<a.length&&""===a[b+f][c+f]||b+e>=0&&""===a[b+e][c+e])||6===g)return 1;for((3===g&&b+f<a.length&&""===a[b+f][c+f]&&b+e>=0&&""===a[b+e][c+e]||4===g)&&h++,e=-1,f=1;b+e>=0&&c-e<a.length&&a[b+e][c-e]===d;)e--;for(;b+f<a.length&&c-f>=0&&a[b+f][c-f]===d;)f++;return g=f-e-1,5===g&&(b+f<a.length&&""===a[b+f][c-f]||b+e>=0&&""===a[b+e][c-e])||6===g?1:((3===g&&b+f<a.length&&""===a[b+f][c-f]&&b+e>=0&&""===a[b+e][c-e]||4===g)&&h++,h>=2?2:0)}function f(e,f,g,h,i){if(void 0===e&&(e=a()),void 0===i&&(i=b()),""!==e[f][g])throw new Error("One can only make a move in an empty position!");if(""!==i.winner)throw new Error("Can only make a move if the game is not over!");var j,k,l=angular.copy(e),m=angular.copy(i);return m.moveIndex=(m.moveIndex+1)%4,m.totalMove++,l[f][g]=0===h?"X":"O",k=d(l,f,g,l[f][g])?l[f][g]:"",j=""!==k||c(m)?{endMatch:{endMatchScores:"X"===k?[1,0]:"O"===k?[0,1]:[0,0]}}:{setTurn:{turnIndex:0===m.moveIndex||1===m.moveIndex?0:1}},m.winner=k,[j,{set:{key:"board",value:l}},{set:{key:"delta",value:{row:f,col:g}}},{set:{key:"gameData",value:m}}]}function g(a,b,c,d){var e=[],f=[],g=[],h=[],j=[];void 0===c&&(c={row:9,col:8});for(var k,l=c.row,m=c.col,n=2*Math.max(18-l,l,18-m,m)+1,o=0,p=0;;){if(++o===n)break;for(k=0;o>k;k++)i(l,++m,a,b,d,f,g,e,j,h);if(++p===n)break;for(k=0;p>k;k++)i(++l,m,a,b,d,f,g,e,j,h);if(++o===n)break;for(k=0;o>k;k++)i(l,--m,a,b,d,f,g,e,j,h);if(++p===n)break;for(k=0;p>k;k++)i(--l,m,a,b,d,f,g,e,j,h)}return{winMoves:f,threatMoves:g.concat(j.concat(h)),possibleMoves:e}}function h(a,b,c,d){var e=g(a,b,c,d);return e.winMoves.concat(e.threatMoves.concat(e.possibleMoves))}function i(a,b,c,d,g,h,i,j,k,l){if(!(0>a||a>18||0>b||b>18)){var m,n=0===d?"O":"X",o=0===d?"X":"O";try{m=f(c,a,b,d,g);var p=e(c,a,b,n),q=e(c,a,b,o);m[0].endMatch||1===q&&(2===g.moveIndex||0===g.moveIndex)?h.push(m):1===p?i.push(m):2===p?k.push(m):2===q?l.push(m):j.push(m)}catch(r){}}}function j(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var e=b[2].set.value,g=e.row,h=e.col,i=d.board,j=d.gameData,k=f(i,g,h,c,j);if(!angular.equals(b,k))return!1}catch(l){return!1}return!0}return{getInitialBoard:a,getInitialGameData:b,getPossibleMoves:h,getDifferentMoves:g,createMove:f,isMoveOk:j}}),angular.module("myApp").controller("Ctrl",["$rootScope","$scope","$log","$timeout","gameService","stateService","gameLogic","aiService","resizeGameAreaService","$translate",function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){e.makeMove(h.createComputerMove(w,x,{maxDepth:1}))}function l(a){w=a.stateAfterMove,z=a.playMode,y=a.turnIndexBeforeMove,void 0===w.board&&(w.board=g.getInitialBoard()),void 0===w.gameData&&(w.gameData=g.getInitialGameData()),u=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,x=a.turnIndexAfterMove,v=u&&""===a.playersInfo[a.yourPlayerIndex].playerId,v&&(u=!1,d(k,700))}function m(a,b){var c=void 0!==w.delta&&w.delta.row===a&&w.delta.col===b;return c&&("playAgainstTheComputer"===z&&0===y||"passAndPlay"===z||"playBlack"===z&&1===y||"playWhite"===z&&0===y)}function n(a,b){var c=void 0!==w.delta&&w.delta.row===a&&w.delta.col===b;return c&&!m(a,b)}function o(a){for(var b=[],c=0;a>c;c++)b.push(c);return b}function p(a,b,c){if(u){var d=b-E.offsetLeft,e=c-E.offsetTop;if(0>d||0>e||d>=E.clientWidth||e>=E.clientHeight)return D.style.display="none",void(A.style.display="none");D.style.display="inline",A.style.display="inline";var f=Math.floor(G*d/E.clientWidth),g=Math.floor(F*e/E.clientHeight),h=s(g,f);C.setAttribute("x1",h.x),C.setAttribute("x2",h.x),B.setAttribute("y1",h.y),B.setAttribute("y2",h.y);var i=r(g,f);D.style.left=i.left+"px",D.style.top=i.top+"px",("touchend"===a||"touchcancel"===a||"touchleave"===a||"mouseup"===a)&&(D.style.display="none",A.style.display="none",t(g,f))}}function q(){return{width:E.clientWidth/G,height:E.clientHeight/F}}function r(a,b){var c=q();return{top:a*c.height,left:b*c.width}}function s(a,b){var c=q();return{x:b*c.width+c.width/2,y:a*c.height+c.height/2}}function t(d,e){b.cellClicked(d,e),a.$apply(function(){c.info("Dragged to "+d+"x"+e)})}console.log("Translation of 'CONNECT6_GAME' is "+j("CONNECT6_GAME")),i.setWidthToHeight(1);var u=!1,v=!1,w=null,x=null,y=null,z=null;window.e2e_test_stateService=f,b.cellClicked=function(a,b){if(c.info(["Clicked on cell:",a,b]),u)try{var d=g.createMove(w.board,a,b,x,w.gameData);u=!1,e.makeMove(d)}catch(f){return void c.info(["Cell is already full in position:",a,b])}},b.shouldShowImage=function(a,b){var c=w.board[a][b];return""!==c},b.getImageSrc=function(a,b){var c=w.board[a][b];return"X"===c?"imgsrc/black.png":"O"===c?"imgsrc/white.png":""},b.getClass=function(a,b){return{piece:!0,animation:n(a,b),slowlyAppear:m(a,b)}};var A=document.getElementById("draggingLines"),B=document.getElementById("horizontalDraggingLine"),C=document.getElementById("verticalDraggingLine"),D=document.getElementById("clickToDragPiece"),E=document.getElementById("gameArea"),F=19,G=19;b.getPreviewSrc=function(){return 1===x?"imgsrc/white.png":"imgsrc/black.png"},window.handleDragEvent=p,b.rows=o(F),b.cols=o(G),b.rowsNum=F,b.colsNum=G,e.setGame({gameDeveloperEmail:"wuping.lei@nyu.edu",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:g.isMoveOk,updateUI:l})}]),angular.module("myApp").factory("aiService",["alphaBetaService","gameLogic",function(a,b){"use strict";function c(a){if(a[0].endMatch){var b=a[0].endMatch.endMatchScores;return b[0]>b[1]?Number.POSITIVE_INFINITY:b[0]<b[1]?Number.NEGATIVE_INFINITY:0}var c=a[1].set.value,e=a[2].set.value.row,f=a[2].set.value.col,g=d(c,e,f,"X"),h=d(c,e,f,"O");return h-g}function d(a,b,c,d){var e,f,g=0;for(e=b-1,f=b+1;e>=0&&a[e][c]===d;)e--;for(;f<a.length&&a[f][c]===d;)f++;for(g+=f-e-2,e=c-1,f=c+1;e>=0&&a[b][e]===d;)e--;for(;f<a.length&&a[b][f]===d;)f++;for(g+=f-e-2,e=-1,f=1;b+e>=0&&c+e>=0&&a[b+e][c+e]===d;)e--;for(;b+f<a.length&&c+f<a.length&&a[b+f][c+f]===d;)f++;for(g+=f-e-2,e=-1,f=1;b+e>=0&&c-e<a.length&&a[b+e][c-e]===d;)e--;for(;b+f<a.length&&c-f>=0&&a[b+f][c-f]===d;)f++;return g+=f-e-2}function e(a,c){return b.getPossibleMoves(a[1].set.value,c,a[2].set.value,a[3].set.value)}function f(a){return"\n"+a[1].set.value.join("\n")+"\n"}function g(d,g,h){var i=b.getDifferentMoves(d.board,g,d.delta,d.gameData),j=i.winMoves,k=i.threatMoves;return 0!==j.length?j[0]:0!==k.length?k[0]:a.alphaBetaDecision([null,{set:{key:"board",value:d.board}},{set:{key:"delta",value:d.delta}},{set:{key:"gameData",value:d.gameData}}],g,e,c,"?debug"===window.location.search?f:null,h)}return{createComputerMove:g}}]);
//# sourceMappingURL=everything.min.js.map