angular.module("myApp",[]).factory("gameLogic",function(){"use strict";function a(){return[["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""]]}function b(){return{totalMove:0,winner:"",moveIndex:1}}function c(a){return a.totalMove>=361}function d(a,b,c){var d,e,f=a[b][c];for(d=b-1,e=b+1;d>=0&&a[d][c]===f;)d--;for(;e<a.length&&a[e][c]===f;)e++;if(e-d-1>=6)return!0;for(d=c-1,e=c+1;d>=0&&a[b][d]===f;)d--;for(;e<a.length&&a[b][e]===f;)e++;if(e-d-1>=6)return!0;for(d=-1,e=1;b+d>=0&&c+d>=0&&a[b+d][c+d]===f;)d--;for(;b+e<a.length&&c+e<a.length&&a[b+e][c+e]===f;)e++;if(e-d-1>=6)return!0;for(d=-1,e=1;b+d>=0&&c-d<a.length&&a[b+d][c-d]===f;)d--;for(;b+e<a.length&&c-e>=0&&a[b+e][c-e]===f;)e++;return e-d-1>=6?!0:!1}function e(e,f,g,h,i){if(void 0===e&&(e=a()),void 0===i&&(i=b()),""!==e[f][g])throw new Error("One can only make a move in an empty position!");if(""!==i.winner)throw new Error("Can only make a move if the game is not over!");var j,k,l=angular.copy(e),m=angular.copy(i);return m.moveIndex=(m.moveIndex+1)%4,m.totalMove++,l[f][g]=0===h?"X":"O",k=d(l,f,g)?l[f][g]:"",j=""!==k||c(m)?{endMatch:{endMatchScores:"X"===k?[1,0]:"O"===k?[0,1]:[0,0]}}:{setTurn:{turnIndex:0===m.moveIndex||1===m.moveIndex?0:1}},m.winner=k,[j,{set:{key:"board",value:l}},{set:{key:"delta",value:{row:f,col:g}}},{set:{key:"gameData",value:m}}]}function f(a,b,c){var d,f,g=[];for(d=0;19>d;d++)for(f=0;19>f;f++)try{g.push(e(a,d,f,b,c))}catch(h){}return g}function g(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var f=b[2].set.value,g=f.row,h=f.col,i=d.board,j=d.gameData,k=e(i,g,h,c,j);if(!angular.equals(b,k))return!1}catch(l){return!1}return!0}return{getInitialBoard:a,getInitialGameData:b,getPossibleMoves:f,createMove:e,isMoveOk:g}}),angular.module("myApp").controller("Ctrl",["$scope","$log","$timeout","gameService","stateService","gameLogic","aiService","resizeGameAreaService",function(a,b,c,d,e,f,g,h){"use strict";function i(){var b=f.getPossibleMoves(a.board,a.turnIndex,a.gameData),c=Math.floor(Math.random()*b.length);d.makeMove(b[c])}function j(b){a.board=b.stateAfterMove.board,a.gameData=b.stateAfterMove.gameData,a.delta=b.stateAfterMove.delta,a.playMode=b.playMode,a.indexBeforMove=b.turnIndexBeforeMove,void 0===a.board&&(a.board=f.getInitialBoard()),void 0===a.gameData&&(a.gameData=f.getInitialGameData()),a.isYourTurn=b.turnIndexAfterMove>=0&&b.yourPlayerIndex===b.turnIndexAfterMove,a.turnIndex=b.turnIndexAfterMove,a.isYourTurn&&""===b.playersInfo[b.yourPlayerIndex].playerId&&(a.isYourTurn=!1,c(i,600))}function k(b,c){var d=void 0!==a.delta&&a.delta.row===b&&a.delta.col===c;return d&&("playAgainstTheComputer"===a.playMode&&1===a.indexBeforMove||"playBlack"===a.playMode&&0===a.indexBeforMove||"playWhite"===a.playMode&&1===a.indexBeforMove)}function l(b,c){var d=void 0!==a.delta&&a.delta.row===b&&a.delta.col===c;return d&&!k(b,c)}function m(a){for(var b=[],c=0;a>c;c++)b.push(c);return b}function n(b,c,d){if(a.isYourTurn){var e=c-w.offsetLeft,f=d-w.offsetTop;if(0>e||0>f||e>=w.clientWidth||f>=w.clientHeight)return v.style.display="none",void(s.style.display="none");v.style.display="inline",s.style.display="inline";var g=Math.floor(y*e/w.clientWidth),h=Math.floor(x*f/w.clientHeight),i=q(h,g);u.setAttribute("x1",i.x),u.setAttribute("x2",i.x),t.setAttribute("y1",i.y),t.setAttribute("y2",i.y);var j=p(h,g);v.style.left=j.left+"px",v.style.top=j.top+"px",("touchend"===b||"touchcancel"===b||"touchleave"===b||"mouseup"===b)&&(v.style.display="none",s.style.display="none",r(h,g))}}function o(){return{width:w.clientWidth/y,height:w.clientHeight/x}}function p(a,b){var c=o();return{top:a*c.height,left:b*c.width}}function q(a,b){var c=o();return{x:b*c.width+c.width/2,y:a*c.height+c.height/2}}function r(c,d){a.cellClicked(c,d),a.$apply(function(){var e="Dragged to "+c+"x"+d;b.info(e),a.msg=e})}h.setWidthToHeight(1),window.e2e_test_stateService=e,a.cellClicked=function(c,e){if(b.info(["Clicked on cell:",c,e]),a.isYourTurn)try{var g=f.createMove(a.board,c,e,a.turnIndex,a.gameData);a.isYourTurn=!1,d.makeMove(g)}catch(h){return void b.info(["Cell is already full in position:",c,e])}},a.shouldShowImage=function(b,c){var d=a.board[b][c];return""!==d},a.getImageSrc=function(b,c){var d=a.board[b][c];return"X"===d?"imgsrc/black.png":"O"===d?"imgsrc/white.png":""},a.getBoardImageSrc=function(a,b){return 3!==a&&9!==a&&15!==a||3!==b&&9!==b&&15!==b?0===a?0===b?"imgsrc/topLeft.png":18===b?"imgsrc/topRight.png":"imgsrc/top.png":18===a?0===b?"imgsrc/bottomLeft.png":18===b?"imgsrc/bottomRight.png":"imgsrc/bottom.png":0===b&&a>0&&18>a?"imgsrc/left.png":18===b&&a>0&&18>a?"imgsrc/right.png":"imgsrc/cross.png":"imgsrc/cross_dot.png"},a.getClass=function(a,b){return{piece:!0,animation:k(a,b),slowlyAppear:l(a,b)}};var s=document.getElementById("draggingLines"),t=document.getElementById("horizontalDraggingLine"),u=document.getElementById("verticalDraggingLine"),v=document.getElementById("clickToDragPiece"),w=document.getElementById("gameArea"),x=19,y=19;a.getPreviewSrc=function(){return 1===a.turnIndex?"imgsrc/white.png":"imgsrc/black.png"},window.handleDragEvent=n,a.rows=m(x),a.cols=m(y),a.rowsNum=x,a.colsNum=y,d.setGame({gameDeveloperEmail:"wuping.lei@nyu.edu",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:f.isMoveOk,updateUI:j})}]),angular.module("myApp").factory("aiService",["alphaBetaService","gameLogic",function(a,b){"use strict";function c(a){if(a[0].endMatch){var b=a[0].endMatch.endMatchScores;return b[0]>b[1]?Number.POSITIVE_INFINITY:b[0]<b[1]?Number.NEGATIVE_INFINITY:0}return 0}function d(a,c){return b.getPossibleMoves(a[1].set.value,c,a[3].set.value)}function e(a){return"\n"+a[1].set.value.join("\n")+"\n"}function f(b,f,g,h){return a.alphaBetaDecision([null,{set:{key:"board",value:b}},null,{set:{key:"gameData",value:g}}],f,d,c,"?debug"===window.location.search?e:null,h)}return{createComputerMove:f}}]);
//# sourceMappingURL=everything.min.js.map