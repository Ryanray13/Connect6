angular.module("myApp",[]).factory("gameLogic",function(){"use strict";function a(){return[["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","",""]]}function b(){return{totalMove:0,winner:"",moveIndex:1}}function c(a){return a.totalMove>=361}function d(a,b,c,d,e){var f,g;for(f=b-1,g=b+1;f>=0&&a[f][c]===d;)f--;for(;g<a.length&&a[g][c]===d;)g++;if(g-f-1>=e)return!0;for(f=c-1,g=c+1;f>=0&&a[b][f]===d;)f--;for(;g<a.length&&a[b][g]===d;)g++;if(g-f-1>=e)return!0;for(f=-1,g=1;b+f>=0&&c+f>=0&&a[b+f][c+f]===d;)f--;for(;b+g<a.length&&c+g<a.length&&a[b+g][c+g]===d;)g++;if(g-f-1>=e)return!0;for(f=-1,g=1;b+f>=0&&c-f<a.length&&a[b+f][c-f]===d;)f--;for(;b+g<a.length&&c-g>=0&&a[b+g][c-g]===d;)g++;return g-f-1>=e?!0:!1}function e(e,f,g,h,i){if(void 0===e&&(e=a()),void 0===i&&(i=b()),""!==e[f][g])throw new Error("One can only make a move in an empty position!");if(""!==i.winner)throw new Error("Can only make a move if the game is not over!");var j,k,l=angular.copy(e),m=angular.copy(i);return m.moveIndex=(m.moveIndex+1)%4,m.totalMove++,l[f][g]=0===h?"X":"O",k=d(l,f,g,l[f][g],6)?l[f][g]:"",j=""!==k||c(m)?{endMatch:{endMatchScores:"X"===k?[1,0]:"O"===k?[0,1]:[0,0]}}:{setTurn:{turnIndex:0===m.moveIndex||1===m.moveIndex?0:1}},m.winner=k,[j,{set:{key:"board",value:l}},{set:{key:"delta",value:{row:f,col:g}}},{set:{key:"gameData",value:m}}]}function f(a,b,c,d){var e=[],f=[],h=[];void 0===c&&(c={row:0,col:0});for(var i,j=c.row,k=c.col,l=2*Math.max(18-j,j,18-k,k)+1,m=0,n=0;;){if(++m===l)break;for(i=0;m>i;i++)g(j,++k,a,b,d,f,h,e);if(++n===l)break;for(i=0;n>i;i++)g(++j,k,a,b,d,f,h,e);if(++m===l)break;for(i=0;m>i;i++)g(j,--k,a,b,d,f,h,e);if(++n===l)break;for(i=0;n>i;i++)g(--j,k,a,b,d,f,h,e)}return{winMoves:f,threatMoves:h,possibleMoves:e}}function g(a,b,c,f,g,h,i,j){if(!(0>a||a>18||0>b||b>18)){var k,l=0===f?"O":"X",m=0===f?"X":"O";try{k=e(c,a,b,f,g),k[0].endMatch||d(c,a,b,m,5)?h.push(k):d(c,a,b,l,5)?i.push(k):j.push(k)}catch(n){}}}function h(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var f=b[2].set.value,g=f.row,h=f.col,i=d.board,j=d.gameData,k=e(i,g,h,c,j);if(!angular.equals(b,k))return!1}catch(l){return!1}return!0}return{getInitialBoard:a,getInitialGameData:b,getPossibleMoves:f,createMove:e,isMoveOk:h,isWinner:d}}),angular.module("myApp").controller("Ctrl",["$rootScope","$scope","$log","$timeout","gameService","stateService","gameLogic","aiService","resizeGameAreaService",function(a,b,c,d,e,f,g,h,i){"use strict";function j(){var a=g.getPossibleMoves(v.board,w,v.delta,v.gameData),b=a.winMoves,c=a.threatMoves;e.makeMove(0!==b.length?b[0]:0!==c.length?c[0]:h.createComputerMove(v,w,{millisecondsLimit:1500}))}function k(a){v=a.stateAfterMove,y=a.playMode,x=a.turnIndexBeforeMove,void 0===v.board&&(v.board=g.getInitialBoard()),void 0===v.gameData&&(v.gameData=g.getInitialGameData()),t=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,w=a.turnIndexAfterMove,u=t&&""===a.playersInfo[a.yourPlayerIndex].playerId,u&&(t=!1,d(j,700))}function l(a,b){var c=void 0!==v.delta&&v.delta.row===a&&v.delta.col===b;return c&&("playAgainstTheComputer"===y&&0===x||"passAndPlay"===y||"playBlack"===y&&1===x||"playWhite"===y&&0===x)}function m(a,b){var c=void 0!==v.delta&&v.delta.row===a&&v.delta.col===b;return c&&!l(a,b)}function n(a){for(var b=[],c=0;a>c;c++)b.push(c);return b}function o(a,b,c){if(t){var d=b-D.offsetLeft,e=c-D.offsetTop;if(0>d||0>e||d>=D.clientWidth||e>=D.clientHeight)return C.style.display="none",void(z.style.display="none");C.style.display="inline",z.style.display="inline";var f=Math.floor(F*d/D.clientWidth),g=Math.floor(E*e/D.clientHeight),h=r(g,f);B.setAttribute("x1",h.x),B.setAttribute("x2",h.x),A.setAttribute("y1",h.y),A.setAttribute("y2",h.y);var i=q(g,f);C.style.left=i.left+"px",C.style.top=i.top+"px",("touchend"===a||"touchcancel"===a||"touchleave"===a||"mouseup"===a)&&(C.style.display="none",z.style.display="none",s(g,f))}}function p(){return{width:D.clientWidth/F,height:D.clientHeight/E}}function q(a,b){var c=p();return{top:a*c.height,left:b*c.width}}function r(a,b){var c=p();return{x:b*c.width+c.width/2,y:a*c.height+c.height/2}}function s(d,e){b.cellClicked(d,e),a.$apply(function(){c.info("Dragged to "+d+"x"+e)})}i.setWidthToHeight(1);var t=!1,u=!1,v=null,w=null,x=null,y=null;window.e2e_test_stateService=f,b.cellClicked=function(a,b){if(c.info(["Clicked on cell:",a,b]),t)try{var d=g.createMove(v.board,a,b,w,v.gameData);t=!1,e.makeMove(d)}catch(f){return void c.info(["Cell is already full in position:",a,b])}},b.shouldShowImage=function(a,b){var c=v.board[a][b];return""!==c},b.getImageSrc=function(a,b){var c=v.board[a][b];return"X"===c?"imgsrc/black.png":"O"===c?"imgsrc/white.png":""},b.getClass=function(a,b){return{piece:!0,animation:m(a,b),slowlyAppear:l(a,b)}};var z=document.getElementById("draggingLines"),A=document.getElementById("horizontalDraggingLine"),B=document.getElementById("verticalDraggingLine"),C=document.getElementById("clickToDragPiece"),D=document.getElementById("gameArea"),E=19,F=19;b.getPreviewSrc=function(){return 1===w?"imgsrc/white.png":"imgsrc/black.png"},window.handleDragEvent=o,b.rows=n(E),b.cols=n(F),b.rowsNum=E,b.colsNum=F,e.setGame({gameDeveloperEmail:"wuping.lei@nyu.edu",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:g.isMoveOk,updateUI:k})}]),angular.module("myApp").factory("aiService",["alphaBetaService","gameLogic",function(a,b){"use strict";function c(a){if(a[0].endMatch){var b=a[0].endMatch.endMatchScores;return b[0]>b[1]?Number.POSITIVE_INFINITY:b[0]<b[1]?Number.NEGATIVE_INFINITY:0}var c=a[1].set.value,e=a[2].set.value.row,f=a[2].set.value.col,g=d(c,e,f,"X"),h=d(c,e,f,"O");return h-g}function d(a,b,c,d){var e,f,g=0;for(e=b-1,f=b+1;e>=0&&a[e][c]===d;)e--;for(;f<a.length&&a[f][c]===d;)f++;for(g+=f-e-2,e=c-1,f=c+1;e>=0&&a[b][e]===d;)e--;for(;f<a.length&&a[b][f]===d;)f++;for(g+=f-e-2,e=-1,f=1;b+e>=0&&c+e>=0&&a[b+e][c+e]===d;)e--;for(;b+f<a.length&&c+f<a.length&&a[b+f][c+f]===d;)f++;for(g+=f-e-2,e=-1,f=1;b+e>=0&&c-e<a.length&&a[b+e][c-e]===d;)e--;for(;b+f<a.length&&c-f>=0&&a[b+f][c-f]===d;)f++;return g+=f-e-2}function e(a,c){var d=b.getPossibleMoves(a[1].set.value,c,a[2].set.value,a[3].set.value);return d.winMoves.concat(d.threatMoves.concat(d.possibleMoves))}function f(a){return"\n"+a[1].set.value.join("\n")+"\n"}function g(b,d,g){return a.alphaBetaDecision([null,{set:{key:"board",value:b.board}},{set:{key:"delta",value:b.delta}},{set:{key:"gameData",value:b.gameData}}],d,e,c,"?debug"===window.location.search?f:null,g)}return{createComputerMove:g}}]);
//# sourceMappingURL=everything.min.js.map